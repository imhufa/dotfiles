import{B as F}from"./996869ba6d63f2f6359689debd17c6d1.js";import{d as G,o as W}from"./6d607360b71772a2db5fecf7e66b72f4.js";import{C as T}from"./bad6fc33885c3dcbb1ba56439c60597f.js";import{d as Z}from"./f6c2ea3b0cc179a4b83702356ba845d1.js";import"./8927cb3a31b28f8a8f7a0cb0bcd7a270.js";class Y{captaina_version="1.0.8";this_page="#reload#";hopekey=null;merchants=null;site_url="https://captaina.co";development_url="https://locallhost";custom_url=["captaina.com"].concat(this.site_url).concat(this.development_url);marketplace_idBydomain={};market_urls={"amazon.fr":"A13V1IB3VIYZZH","amazon.sa":"A17E79C6D8DWNP","amazon.nl":"A1805IZSGTT6HS","amazon.sg":"A19VAU5U5O7RUS","amazon.com.mx":"A1AM78C64UM0Y8","amazon.pl":"A1C3SOZRARQ6R3","amazon.co.uk":"A1F83G8C2ARO7P","amazon.de":"A1PA6795UKMFR9","amazon.es":"A1RKKUPIHCS9HS","amazon.co.jp":"A1VC38T7YXB528","amazon.in":"A21TJRUUN4KGV","amazon.ca":"A2EUQ1WTGCTBG2","amazon.se":"A2NODRKZP88ZB9","amazon.com.br":"A2Q3Y263D00KWC","amazon.ae":"A2VIGQ35RCS4UG","amazon.com.tr":"A33AVAJ2PDY3EV","amazon.com.au":"A39IBJ37TRP1C6","amazon.com.be":"AMEN7PMS3EDWL","amazon.it":"APJ6JRA9NG5V4","amazon.eg":"ARBP9OOSHTCHU","amazon.com":"ATVPDKIKX0DER"};market_host_by_details={"amazon.fr":{country_code:"fr",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.sa":{country_code:"sa",currency:"SAR",currency_symbol:"﷼",currency_position:"0"},"amazon.nl":{country_code:"nl",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.sg":{country_code:"sg",currency:"SGD",currency_symbol:"$",currency_position:"0"},"amazon.com.mx":{country_code:"mx",currency:"MXN",currency_symbol:"$",currency_position:"0"},"amazon.pl":{country_code:"pl",currency:"PLN",currency_symbol:"zł",currency_position:"0"},"amazon.co.uk":{country_code:"gb",currency:"GBP",currency_symbol:"£",currency_position:"0"},"amazon.de":{country_code:"de",currency:"EUR",currency_symbol:"€",currency_position:"0"},"amazon.es":{country_code:"es",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.co.jp":{country_code:"jp",currency:"JPY",currency_symbol:"¥",currency_position:"0"},"amazon.in":{country_code:"in",currency:"INR",currency_symbol:"₹",currency_position:"0"},"amazon.ca":{country_code:"ca",currency:"CAD",currency_symbol:"$",currency_position:"0"},"amazon.se":{country_code:"se",currency:"SEK",currency_symbol:"kr",currency_position:"1"},"amazon.com.br":{country_code:"br",currency:"BRL",currency_symbol:"R$",currency_position:"0"},"amazon.ae":{country_code:"ae",currency:"aED",currency_symbol:"د.إ",currency_position:"0"},"amazon.com.tr":{country_code:"tr",currency:"TRY",currency_symbol:"₺",currency_position:"1"},"amazon.com.au":{country_code:"au",currency:"aUD",currency_symbol:"$",currency_position:"0"},"amazon.com.be":{country_code:"be",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.it":{country_code:"it",currency:"EUR",currency_symbol:"€",currency_position:"1"},"amazon.eg":{country_code:"eg",currency:"EGP",currency_symbol:"جنيه",currency_position:"0"},"amazon.com":{country_code:"us",currency:"USD",currency_symbol:"$",currency_position:"0"}};market_pattern_urls=[];pattern_urls=[];debugMode=!1;debugInfo=!1;api_url="https://_crawl.captaina.co";check_notifications_executing=!1;constructor(){Object.keys(this.market_urls).forEach((e=>{this.market_pattern_urls.push("https://*."+e+"/*"),this.marketplace_idBydomain[this.market_urls[e]]="https://www."+e})),Object.keys(this.market_urls).forEach((e=>{this.pattern_urls.push("https://*."+e+"/*"),this.marketplace_idBydomain[this.market_urls[e]]="https://www."+e})),this.custom_url.forEach((e=>{-1===e.indexOf("!*")?this.pattern_urls.push("https://*."+e.replace("https://","")+"/*"):this.pattern_urls.push(e)}))}getKey(){return a.Browser().storage.local.get("hopekey").then((e=>{typeof e.hopekey<"u"&&(this.hopekey=e.hopekey??null)}))}}const U=new Y,o={Local:{},Sync:{},LocalOld:{},SyncOld:{},constructor(){},build:async(e="local",t=0)=>await new Promise((async(n,i)=>await a.Browser().storage[e].get(null).then((async i=>{let s=a.firstUpperCase(e),l=o[s];return Object.keys(i).forEach((e=>{typeof l[e]<"u"&&delete l[e]})),Object.keys(l).length>0&&(await a.Browser().storage[e].set(l),i=Object.assign(l,i)),o[s]=a.JsonParse(i),n(1==t?o[e]:o)})).catch((e=>{console.log(e)})))),async listener(e){return typeof a.Browser().storage.migration_status>"u"&&(a.Browser().storage.migration_status=!1),a.Browser().storage.onChanged.addListener(((t,n)=>{let i=Object.keys(t);if(-1!==i.indexOf("migration_status")){let e=i[i.indexOf("migration_status")];a.Browser().storage.migration_status=t[e].newValue??!1}return Object.keys(t).forEach((e=>{let a=e,i=t[e].oldValue,s=t[e].newValue;if(typeof o[n]>"u"&&(o[n]={}),typeof o[`${n}Old`]>"u"&&(o[`${n}Old`]={}),typeof s<"u"&&null!=s?typeof s[a]<"u"?this[n][a]=o[n][a]=s[a]:this[n][a]=o[n][a]=s:this[n][a]=o[n][a]=null,typeof i<"u"&&null!=i?typeof i[a]<"u"?this[`${n}Old`][a]=o[`${n}Old`][a]=i[a]:this[`${n}Old`][a]=o[`${n}Old`][a]=i:this[`${n}Old`][a]=o[`${n}Old`][a]=null,-1!==a.indexOf("ai_single_")){let e=a.replace("ai_single_","");null==this[n].ai_single&&(this[n].ai_single=o[n].ai_single={}),this[n].ai_single&&typeof this[n].ai_single[e]>"u"&&(this[n].ai_single[e]=o[n].ai_single[e]={}),typeof s[a]<"u"?this[n].ai_single[e]=o[n].ai_single[e]=s[a]:this[n].ai_single[e]=o[n].ai_single[e]=s,console.log(o[n].ai_single[e],s[a],s)}})),e.storage=o,Object.keys(t).forEach((t=>{"settings"==t&&null==o[n][t]&&console.error(t,o[n][t]),o[n][t]!=o[`${n}Old`][t]&&e.changeListener(n,t,o[n][t],o[`${n}Old`][t],a.Browser().storage.migration_status??!1)})),o}))}},B={db_name:"AiTopia",open_db:null,db_version:1,open:async(e=null)=>(null!=e&&(B.db_name=e),location&&location.search&&-1!==location.search.indexOf("clear")&&null==B.open_db&&await G(B.db_name),B.open_db=await W(B.db_name,B.db_version,{upgrade(e,t,a,n,o){e.createObjectStore(B.db_name,{keyPath:"key",autoIncrement:!1})},blocked(e,t,a){console.log("BLOCKED")},blocking(e,t,a){console.log("BLOCKING")},terminated(){console.log("TERMINATE")}})),storage:{get:async(e=null)=>{let t={};return"string"==typeof e&&null!=e&&(e=[e]),(null==e||"object"!=typeof e)&&(e=[]),new Promise((async(n,i)=>{let s=await(await B.open()).transaction(B.db_name,"readonly").objectStore(B.db_name),l=!1,r=[];if(e&&e.length>0){for(let t of e){let e=null;a.notUndefined(o.Local,t)?e={key:t,value:a.notUndefined(o.Local,t)}:(t=a.AesEnCrypt(t),e=await s.get(t),a.notUndefined(e,"key")&&(e.key=a.AesDeCrypt(e.key)??e.key),a.notUndefined(e,"value")&&(e.value=a.JsonParse(a.AesDeCrypt(e.value)??e.value))),r.push(e)}l=!0}l||(r=await s.getAll()),r&&r.forEach((e=>{if(a.notUndefined(e,"value")){let n=a.notUndefined(e,"key"),i=a.notUndefined(e,"value");l||(n=a.AesDeCrypt(n)??null,i=a.JsonParse(a.AesDeCrypt(i)??null)??null),t[n]=o.Local[n]=i}})),n(t)}))},set:async(e={})=>await new Promise((async(t,n)=>{let i=await(await B.open()).transaction(B.db_name,"readwrite").objectStore(B.db_name),s={};if(e&&Object.keys(e).length>0){let t=!1;for(const n of Object.keys(e)){let l=!1;e[n]=a.JsonParse(e[n]);let r={key:a.AesEnCrypt(n),value:a.AesEnCrypt(JSON.stringify(e[n]))??null,updated_date:(new Date).getTime()},c=await i.getKey(a.AesEnCrypt(n)),u=await i.get(a.AesEnCrypt(n));a.notUndefined(u,"key")&&(u.key=a.AesDeCrypt(u.key)??u.key),a.notUndefined(u,"value")&&(u.value=a.JsonParse(a.AesDeCrypt(u.value)??u.value)),typeof c>"u"?(await i.add(r),t=l=!0,s[n]={oldValue:null,newValue:e[n]}):a.notUndefined(u,"value")!=JSON.stringify(e[n])&&(s[n]={oldValue:null,newValue:e[n]},s[n].oldValue=a.JsonParse(a.notUndefined(u,"value")??null)??null,await i.put(r),t=l=!0),l&&(o.Local[n]=e[n])}t&&window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:s}))}t(!0)})),remove:async e=>new Promise((async(t,n)=>{if(e){let t=await(await B.open()).transaction(B.db_name,"readwrite").objectStore(B.db_name);if(e.length>0&&"object"==typeof e)for(const n of e)if(typeof o.Local[n]<"u"||typeof o.Local[n]<"u"){let e={};e[n]={oldValue:o.Local[n]??o.Local[n]??null,newValue:null},await t.delete(a.AesEnCrypt(n)),typeof o.Local[n]<"u"&&delete o.Local[n],typeof o.Local[n]<"u"&&delete o.Local[n],window.dispatchEvent(new CustomEvent("localStorageOnChange",{detail:e}))}}t(!0)})),clear:async()=>new Promise((async(e,t)=>{await G(B.db_name),window.location.reload(),e(!0)}))},customAddListener:(e,t,a)=>window.addEventListener(e,(e=>"function"==typeof t?t(e.detail,a):{detail:e.detail,namespace:a}))};typeof window<"u"&&(window.umut_storage=B.storage);const Q={storage:{local:B.storage,onChanged:{addListener:(e,t)=>B.customAddListener("localStorageOnChange",e,"Local")}},runtime:{id:null}};let D=F;typeof chrome<"u"&&(D=chrome??D);const N=["chatgptextension.ai","aitopia.ai"];let M=location.hostname.split(".");var K;M.length>2&&(delete M[0],M=Object.values(M)),M=M.join(".");const J=(null==(K=null==D?void 0:D.runtime)?void 0:K.id)??null,S=J?`chrome-extension://${J}`:"";var E=N[N.indexOf(M)]??N[0];const V="chat.";let X=!1,P=E;E&&(E.split(".").length>2&&(delete(E=E.split("."))[0],E=Object.values(E).join(".").toString()),P=E,-1===E.indexOf("chatgptextension")&&-1===E.indexOf("extension://")&&(P=V+P));const I="/src/html",d={domain:E,domain_allows:N,runtime_id:J??null,main_dir:I,site:`https://${P}`,site_buy_plan:`https://${P}/subscription`,site_payment:`https://${P}/payment`,site_pricing:`https://${P}/pricing`,login:`https://${P}/auth`,api_url:`https://extensions.${E}`,download_url:`https://download.${E}`,cdn_url:`https://cdn.${E}`,web_app_prefix:V,web_app:`https://${V}${E}`,extension_pricing:`${S}${I}/pricing.html`,extension_payment_success:`${S}${I}/payment_success.html`,extension_google_page:"https://chromewebstore.google.com/detail/chatgpt-sidebar-gpt-4-vis/becfinhbfclcgokjlobojlnldbfillpf",extension_id:J,manuel_extension_id:"becfinhbfclcgokjlobojlnldbfillpf",extension_dir:`${S}/`,lang_cache_type:"Local",debugMode:0,version:"4.4.2",app_name:"ChatGPT Sidebar & GPT-4 Vision with AI Tools | AITOPIA",app_title:"ChatGPT Sidebar & GPT-4 Vision with AI Tools | AITOPIA",app_description:"ChatGPT Sidebar & GPT-4 Vision by AITOPIA helps you to use ChatGPT-4o & Claude 3.5 in every browser tab easily",build_finish:!1,mode:"production",debug_time:"",web_access_search_limit:5,image_upscaling_id:"image-upscaling",console_data:[],hello_world_test:"function helloWorld(args){if (!args)return false;}function testing(args){if (args)return true;}",disallow_pages:["accounts.google.com"],is_web_app:X,search_pages:{"www.google.com/search":{selector:'body textarea[type="search"],body textarea[aria-label="search"],body textarea[name="q"]',container:"#rhs",empty_selector:"#rcnt",empty_selector_position:"#center_col",empty_element:'<div class="TQc1id rhstc4" jscontroller="cSX9Xe" data-pws="1300" data-spe="true" jsaction="rcuQ6b:npT2md" id="rhs" jsdata="MdeVKb;_;A38Ny0" role="complementary" data-hveid="CAEQAA"></div>'},"www.yandex.com/search":{selector:'body [role="search"] [name="text"]',container:"#search-result-aside",empty_selector:".main__content > div",empty_selector_position:"",empty_element:'<div class="content__right content__right_cols_12" id="search-result-aside" data-log-node="2_apy0w00g" tabindex="-1"><div class="serp-list serp-list_right_yes"></div></div>'},"www.bing.com/search":{selector:'body [role="search"] [type="search"],body [role="search"] .b_searchbox',container:"#b_context",empty_selector:"#b_content > aside:first-child",empty_selector_position:"",empty_element:'<ol id="b_context"></ol>'},"www.duckduckgo.com":{selector:'body #search_form_input, body #search_form > input[type="text"]',container:'#web_content_wrapper [data-testid="sidebar"]',empty_selector:"",empty_selector_position:"",empty_element:'<section data-testid="sidebar" data-area="sidebar"></section>'},"search.yahoo.com/search":{selector:'body [role="search"] input[type="text"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.baidu.com/s":{selector:'#form [name="wd"],#form #kw',container:"#container #content_right",empty_selector:"",empty_selector_position:"",empty_element:""},"www.ask.com/web":{selector:'[name="searchBoxContainer"] [name="q"]',container:"main .l-right-container",empty_selector:"",empty_selector_position:"",empty_element:""},"search.aol.com":{selector:'[role="search"] [name="q"]',container:"#results > #cols > #right",empty_selector:"",empty_selector_position:"",empty_element:""}},ai_reply:{"mail.google.com":{reply_button:".ams.bkH",button:".amn",container:'[role="listitem"]:last-child',alternative_container:'[role="listitem"]:last-child',edit_container:'[role="listitem"] .editable',reply_insert_container:".Am.Al.editable.LW-avf",dot_position:{bottom:"25%",left:"85%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".gD[email]",mode:"attribute",type:"email"},{name:"sender_name",selector:".gD[name]",mode:"attribute",type:"name"},{name:"receiver_email",selector:".g2[email]",mode:"attribute",type:"email"},{name:"receiver_name",selector:".g2[name]",mode:"attribute",type:"name"},{name:"email_content",selector:".a3s > *",mode:"simple",type:"innerText"}]},"outlook.live.com":{reply_button:".th6py button:first-child",button:".Jj1JU,.th6py",container:'[role="document"][aria-expanded="true"]',alternative_container:'[role="document"][aria-expanded]',edit_container:'[id*="editorParent_"] [role="textbox"][contenteditable="true"]',reply_insert_container:"[id*='editorParent_'] [contenteditable=\"true\"] > *:first-child",dot_position:{bottom:"50%",left:"80%"},detail_elements:[{name:"history",selector:".adL.gmail_quote,.adL .gmail_quote",mode:"simple",type:"textContent"},{name:"sender_email",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"sender_name",selector:".OZZZK",mode:"simple",type:"textContent"},{name:"receiver_email",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"receiver_name",selector:"._EType_RECIPIENT_ENTITY [aria-label]",mode:"attribute",type:"aria-label"},{name:"email_content",selector:'[role="document"][aria-expanded="true"] [id*="UniqueMessageBody_"] div',mode:"simple",type:"innerText"}]}},ai_reply_data:{},click_open_url:{"aitopia-pricing":"extension_pricing","aitopia-login":"login","aitopia-g-extension":"extension_google_page","aitopia-options":"./src/html/options.html","aitopia-options-search":"./src/html/options.html?mode=search"},aspect_rations:[{value:"21 : 9",tooltipText:"1536 x 640",width:"1536",height:"640"},{value:"16 : 9",tooltipText:"1344 x 768",width:"1344",height:"768"},{value:"3 : 2",tooltipText:"1216 x 832",width:"1216",height:"832"},{value:"5 : 4",tooltipText:"1152 x 896",width:"1152",height:"896"},{value:"1 : 1",tooltipText:"1024 x 1024",width:"1024",height:"1024"},{value:"4 : 5",tooltipText:"896 x 1152",width:"896",height:"1152"},{value:"2 : 3",tooltipText:"832 x 1216",width:"832",height:"1216"},{value:"9 : 16",tooltipText:"768 x 1344",width:"768",height:"1344"},{value:"9 : 21",tooltipText:"640 x 1536",width:"640",height:"1536"}],styles:[{name:"None",style:"none",icon:`${S}/assets/images/image_chat/default.png`},{name:"Anime",style:"anime",icon:`${S}/assets/images/image_chat/anime.png`},{name:"Photographic",style:"photographic",icon:`${S}/assets/images/image_chat/photographic.png`},{name:"Digital Art",style:"digital-art",icon:`${S}/assets/images/image_chat/digital_art.png`},{name:"Comic Book",style:"comic-book",icon:`${S}/assets/images/image_chat/comic_book.png`},{name:"Fantasy Art",style:"fantasy-art",icon:`${S}/assets/images/image_chat/fantasy_art.png`},{name:"Line Art",style:"line-art",icon:`${S}/assets/images/image_chat/line_art.png`},{name:"Analog Film",style:"analog-film",icon:`${S}/assets/images/image_chat/analog_film.png`},{name:"Neon Punk",style:"neon-punk",icon:`${S}/assets/images/image_chat/neon_punk.png`},{name:"Isometric",style:"ısometric",icon:`${S}/assets/images/image_chat/isometric.png`},{name:"Low Poly",style:"low-poly",icon:`${S}/assets/images/image_chat/low_poly.png`},{name:"Origami",style:"origami",icon:`${S}/assets/images/image_chat/origami.png`},{name:"Cinematic",style:"cinematic",icon:`${S}/assets/images/image_chat/cinematic.png`},{name:"3D Model",style:"3d-model",icon:`${S}/assets/images/image_chat/three_d_model.png`},{name:"Pixel Art",style:"pixel-art",icon:`${S}/assets/images/image_chat/pixel_art.png`}],tools:[{id:1,name:"Remove Background",description:"Extract the main subject from a image with incredible accuracy.",video:`${S}/assets/videos/remove-background-demo.mp4`,actionCode:"remove-background"},{id:2,name:"Remove Text",description:"Remove text from any image.",video:`${S}/assets/videos/remove-text-demo.mp4`,actionCode:"remove-text"},{id:3,name:"Upscale",description:"Upscale your image by 2× or 4× with in seconds.",video:`${S}/assets/videos/Enhance.webm`,actionCode:"image-upscaling"},{id:4,name:"Replace Background",description:"Teleport anything, any where with AI.",video:`${S}/assets/videos/ReplaceBackground.webm`,actionCode:"replace-background"}],editTools:[{credit:1,id:"image-upscaling",image:!0,mask:!1,name:"Image Upscaling",prompt:!1,size:!0,explanation:"Select image magnification:",sectionWidth:90},{credit:1,id:"reimagine",image:!0,mask:!1,name:"Variation",prompt:!1,size:!1,explanation:null,sectionWidth:null},{credit:4,id:"remove-background",image:!0,mask:!1,name:"Remove Background",prompt:!1,size:!1,explanation:"Remove background from this image",sectionWidth:65},{credit:4,id:"remove-text",image:!0,mask:!1,name:"Remove Text",prompt:!1,size:!1,explanation:"Remove all text from the image",sectionWidth:60},{credit:6,id:"replace-background",image:!0,mask:!1,name:"Replace Background",prompt:!0,size:!1,explanation:null,sectionWidth:90}],pinnedContextPrompts:{reading:[42,43],writing:[45,56]},contextBlacklist:{"www.google.com":{selectors:["textarea[role='combobox']"]}},ExtensionBrowser:D??chrome??{},Browser:J?D??chrome??{}:Q,api_call_try:0,api_call_max_try:15,reply_prompts:{getEmailIntent:64,getEmailKeyPoints:65,getRelatedSuggestions:66,askAiReply:63}},w={switchbar:"chat",color_mode:"auto",ai_mode:"local",ai_key:null,language:ee(),language_name:null,language_detail:{},send_cmd:"enter",sidebar_cmd:"ctrl+y",color_mode_cmd:"ctrl+shift+l",fullscreen_cmd:"ctrl+shift+f",sidebar_show_icon:!0,sidebar_position:"right",sidebar_space:"overlay",search:!0,search_ask_mode:"manuel",ai_model:"GPT-3.5",web_access:!1,context_reading:!0,context_reading_show_cmd:"ctrl",context_menu_shortcut_cmd:"ctrl+j",context_writing:!0,context_writing_input:!0,email_assistant:!0};function ee(){let e=navigator.language||(navigator.userLanguage??"en");return-1!=e.indexOf("-")&&(e=e.split("-")[0]),-1!=e.indexOf("_")&&(e=e.split("_")[0]),e}const H={QUESTION:{START:"<a href='javascript:;' class=\"ait-action-question\">",END:"</a>"},SUGGESTION:{START:"<a href='javascript:;' class=\"ait-action-suggestion\">",END:"<span>→</span></a>"}};console.time();const te={chats:{},ai_all_response:{},ai_response:[],instance:null,aborting:{},long_prefix:"<#Finished#>",count:0,extra_key:null,expires:{},ai_wait:!1,prompt_prefix:"##",async chat(e="",t="GPT-3.5",n="ai_chat",o="__all",i=!1,s=!1,l=null,r=!1,c={}){if(this.ai_wait)return;typeof this.aborting[o]<"u"&&(this.aborting[o]=null);let u=await a.Browser().storage.local.get(["settings","credit_detail","expires","ai_image_url","ai_chat_ids",n]);this.key_detail=await a.Browser().storage.local.get(["uuid_hopekey","uuid_search"]),this.settings=a.notUndefined(u,"settings"),this.waiting(!0),this.credit_detail=a.notUndefined(u,"credit_detail"),typeof this.ai_all_response[o]>"u"&&(this.ai_all_response[o]={}),typeof this.ai_all_response[o][n]>"u"&&(this.ai_all_response[o][n]=[]);let g=a.notUndefined(u,`${n}`);null!=typeof u.expires&&(this.expires=u.expires);let p={};"string"==typeof g?(p=JSON.parse(g),Object.keys(p).length>0&&Object.keys(p).forEach((e=>{typeof this.ai_all_response[e]>"u"&&(this.ai_all_response[e]={}),this.ai_all_response[e][n]=Object.values(p[e])}))):(p=g,null!=p&&("ai_chat"==n?this.ai_all_response[o][n]=Object.values(p):typeof p[o]<"u"&&(this.ai_all_response[o][n]=Object.values(p[o])))),"ai_single"==n&&1==i&&0==r&&typeof this.ai_all_response[o]<"u"&&typeof this.ai_all_response[o][n]<"u"&&(this.ai_all_response[o][n]=[],await this.setDataStorage(n,o),Object.keys(this.ai_all_response[o][n]).length),this.uuid_search=a.notUndefined(this.key_detail,"uuid_search"),this.hopekey=a.notUndefined(this.key_detail,"uuid_hopekey"),document.querySelector("#aitopia-container");let _=`${d.api_url}/ai/send`;if(null!=this.credit_detail){let e=t;if(this.settings.web_access&&(e="GPT-4"),typeof this.credit_detail[e]<"u"&&this.credit_detail[e].balance<1&&-999!=this.credit_detail[e].balance)return this.ai_all_response[o][n].forEach(((e,t)=>{"limit"==e.role&&delete this.ai_all_response[o][n][t]})),this.ai_all_response[o][n]=Object.values(this.ai_all_response[o][n]),this.ai_all_response[o][n].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),await this.setDataStorage(n,o),void(await this.waiting(!1))}let h=this.ai_all_response[o][n],m=0,y=!1;Object.keys(this.ai_all_response[o][n]).length>0&&!a.notUndefined(c,"search")&&this.ai_all_response[o][n].forEach(((e,t)=>{m++,h!=m&&1==this.ai_all_response[o][n][t].loading&&(this.ai_all_response[o][n][t].loading=!1,y=!0),"limit"==e.role&&(delete this.ai_all_response[o][n][t],this.ai_all_response[o][n]=Object.values(this.ai_all_response[o][n]),y=!0)})),y&&await this.setDataStorage(n,o);let f="";this.count++;let w="user";"image"==t&&(w="image"),(String(e).trim().length>0||"image"==w)&&0==r&&(c.prompt_mode=s,this.ai_all_response[o][n].push({item:e,role:w,model:t,title:l,loading:"image"==w,extra_data:c})),"image"!=t&&null!=a.notUndefined(u,"ai_image_url")&&""!==a.notUndefined(u,"ai_image_url")&&(t="GPT-4 Vision",this.settings.web_access=!1,c.ai_image_url=a.notUndefined(u,"ai_image_url"),await a.Browser().storage.local.set({ai_image_url:null}),await a.Browser().storage.local.remove(["ai_image_url"]));let b=a.ChatId(n,o),x={history:this.ai_all_response[o][n],text:e,model:t,stream:"image"!=t,uuid_search:this.uuid_search,mode:n,prompt_mode:s,extra_key:o,extra_data:c,chat_id:b,language_detail:this.settings.language_detail,is_continue:r};this.settings.ai_key&&"api"==this.settings.ai_mode&&(x.token=this.settings.ai_key),this.settings.language&&(x.lang_code=this.settings.language);let v=this.ai_all_response[o][n].length;("image"==t||a.notUndefined(c,"search"))&&(v-=1),v<0&&(v=0);let k="";1==r&&this.ai_all_response[o][n].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="",v=t,f=k=e.item)})),this.ai_all_response[o][n].forEach(((e,t)=>{typeof e.finish_reason<"u"&&"length"==e.finish_reason&&(e.finish_reason="stop")})),"image"!=t&&(this.ai_all_response[o][n][v]={item:k,role:"system",model:t,loading:!0,title:l,extra_data:c}),await this.setDataStorage(n,o),this.aborting[o]=new AbortController;let S=document.querySelectorAll("#ait-stop-chat-"+n),O=document.querySelectorAll("#ait-stop-chat-"+n+" button");null!=O&&null!=S&&(S.forEach((e=>{e.classList.remove("ait-hide"),e.classList.add("ait-show")})),this.aborting[o].signal.addEventListener("abort",(()=>{"ai_single"==n?Object.values(this.ai_all_response[o][n]).length>0&&this.ai_all_response[o][n].forEach(((e,t)=>{this.ai_all_response[o][n][t].loading=!1,this.ai_all_response[o][n][t].stop=!0})):(this.ai_all_response[o][n][v].loading=!1,this.ai_all_response[o][n][v].stop=!0),this.setDataStorage(n,o)})),Object.keys(O).length>0&&O.forEach((e=>{e.onclick=e=>{this.aborting[o].abort(),a.sendMessage("uuid",{data:1}),S.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")}))}})));let B=null;return await this.setDataStorage(n,o),-1!==["image"].indexOf(t)?await this.imageApi(n,t,o,x,v,S,B,_,f).finally((async()=>await this.waiting(!1))):1==a.notUndefined(this.settings,"web_access")&&-1===["image"].indexOf(t)&&0==r&&"__all"==o&&!a.notUndefined(c,"search")&&e.length<=300&&0==s?(a.Browser().web_access_mode=n,a.Browser().web_access_extra_key=o,a.sendMessage("GoogleSearchCall",e,"GoogleSearchCallback","tabs")):await this.aiApi(n,t,o,x,v,S,B,_,f).finally((async()=>{await this.waiting(!1)}))},async AiSync(e,t,n="gpt-3.5",o){let i={history:e,text:t,model:"gpt-3.5",stream:!1,uuid_search:this.uuid_search,mode:"ai_chat",prompt_mode:!1,extra_key:"__all",extra_data:o??{search_fixer:!0},chat_id:null,language_detail:this.settings.language_detail};return a.apiCall(`${d.api_url}/ai/send`,i,"POST",-1).then((e=>a.notUndefined(e,"choices.0.message.content")??null))},async imageApi(e,t,n,o,i,s,l,r,c){if((o.extra_data.image_count??1)>this.credit_detail[t].balance)return this.ai_all_response[n][e].forEach(((t,a)=>{"limit"==t.role&&delete this.ai_all_response[n][e][a]})),this.ai_all_response[n][e][i].loading=!1,this.ai_all_response[n][e]=Object.values(this.ai_all_response[n][e]),this.ai_all_response[n][e].push({item:"Usage Limit please upgrade plan.",role:"limit",model:t}),void(await this.setDataStorage(e,n));let u={role:"image",item:o.text,loading:!0,images:[]};this.ai_all_response[n][e][i]={...this.ai_all_response[n][e][i],...u},await this.setDataStorage(e,n);let d="/ai/image";return null!=o.extra_data.action&&(d="/ai/image_editing"),a.apiCall(d,o,"POST",-1).then((async r=>{let c=r;return typeof c.images>"u"&&(c.images=[]),typeof c.seed>"u"&&(c.seed=null),u.images=c.images||[],u.loading=!1,u.seed=c.seed||null,this.ai_all_response[n][e][i]={...this.ai_all_response[n][e][i],...u},typeof c<"u"&&typeof c.message<"u"&&this.ai_all_response[n][e].push({item:c.message??null,role:c.type??"error",model:t,finish_reason:l,loading:!1}),await this.setDataStorage(e,n),a.sendMessage("uuid",{data:1}),null!=s&&s.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),null!=o.extra_data.action&&a.Browser().storage.local.get("image_settings").then((e=>{e.image_settings.image=null,e.image_settings.action=null,a.Browser().storage.local.set(e)})),this.ai_all_response[n][e][i]})).catch((e=>{console.log(e)}))},async aiApi(e,t,n,o,i,s,l,r,c){let u=0;return fetch(r,{headers:{accept:"text/plain",hopekey:this.hopekey??null},body:JSON.stringify(o),method:"POST",signal:this.aborting[n].signal}).then((async t=>{const a=t.body.getReader();let o=async()=>a.read().then((async({value:t,done:a})=>{if(await this.streamFormatter(t,a,n,e,i,u),u++,!a)return await o()})).catch((t=>{this.waiting(!1),t instanceof DOMException&&"AbortError"==t.name?null!=document.querySelector(".ai_loading")&&document.querySelector(".ai_loading").classList.remove("ai_loading"):("network error"==t.message?(this.ai_all_response[n][e][i].loading=!1,console.log(t.message)):(this.ai_all_response[n][e][i].loading=!1,console.log(t.message,t.toString(),t),console.log(this.ai_all_response[n][e]),console.log(c??null)),this.setDataStorage(e,n))}));return await o()})).catch((t=>{this.waiting(!1),this.ai_all_response[n][e][i].loading=!1,this.ai_all_response[n][e][i].loading=!1;let o='<span class="ait-text-red-600">'+a.__("(Internet connection lost. Please try again)")+"</span>";null!=s&&s.forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})),c.length>0&&(o=c+"\n\n"+o),this.ai_all_response[n][e][i].item=o,this.setDataStorage(e,n),console.log(t)}))},async setData(e,t,n=!0){let o={};return o[e]={},new Promise((i=>{null===this.instance&&i(!1);let s=this.instance[e];"string"==typeof s&&null!=s&&(s=JSON.parse(s)),"__all"!=t&&null!=t&&"ai_chat"!=e&&n?(null!=s&&Object.keys(s).length>0&&Object.keys(s).forEach((t=>{o[e][t]=s[t]})),typeof this.ai_all_response[t]<"u"&&typeof this.ai_all_response[t][e]<"u"&&(o[e][t]=this.ai_all_response[t][e])):o[e]=this.ai_all_response[t][e],this.instance.storage&&this.instance.storage.Local&&(this.instance.storage.Local[e]=o[e]),this.instance[e]=o[e],this.instance.$data&&(this.instance.$data[e]=o[e]),a.scrollToBottom(),i(o)}))},async setDataStorage(e,t,n=!0){let o={};return o[e]={},await a.Browser().storage.local.get(e).then((async i=>{let s=i[e];return"string"==typeof s&&null!=s&&(s=JSON.parse(s)),"__all"!=t&&null!=t&&"ai_chat"!=e&&n?(null!=s&&Object.keys(s).length>0&&Object.keys(s).forEach((t=>{o[e][t]=s[t]})),typeof this.ai_all_response[t]<"u"&&typeof this.ai_all_response[t][e]<"u"&&(o[e][t]=this.ai_all_response[t][e]),Object.keys(this.ai_all_response).forEach((t=>{typeof this.ai_all_response[t][e]<"u"&&(o[e][t]=this.ai_all_response[t][e])}))):o[e]=this.ai_all_response[t][e],a.scrollToBottom(),await a.Browser().storage.local.set(o)}))},async streamFormatter(e,t,n,o,i,s=0){let l=(new TextDecoder).decode(e,{stream:!0});if(l=l.replace(/"data":\{/gi,'"data": {').replace(/data:\{/gi,"data: {").replace(/"error":\{/gi,'"error": {').replace(/error:\{/gi,"error: {").replace(/\r/,"\n"),typeof l.match>"u")return void(this.ai_all_response[n][o][i].loading=!1);const r=l.match(/data: \{(.*)\}/gi);if(l.match(/error: \{(.*)\}/gi),t)return this.ai_all_response[n][o][i].loading=!1,await this.setDataStorage(o,n),await this.waiting(!1),a.sendMessage("uuid",{data:1}),void a.scrollToBottom();if(null!=r||t||0!=s){if(null==r&&t&&s<2&&(null===this.ai_all_response[n][o][i].item||""===this.ai_all_response[n][o][i].item)){this.ai_all_response[n][o][i].loading=!1,this.ai_all_response[n][o][i].loading=!1;let e='<span class="ait-text-red-600">'+a.__("(Internet connection lost. Please try again)")+"</span>";return this.ai_all_response[n][o][i].item=e,this.ai_all_response[n][o][i].role="error",await this.setDataStorage(o,n),await this.waiting(!1),this.ai_all_response[n][o][i].item}}else{let e=a.JsonParse(l);if(a.notUndefined(e,"error"))return this.ai_all_response[n][o][i].loading=!1,this.ai_all_response[n][o][i].item=a.notUndefined(e,"error.message"),this.ai_all_response[n][o][i].role="error",await this.setDataStorage(o,n),await this.waiting(!1),this.ai_all_response[n][o][i].item}if("object"!=typeof r||null===r||!r){this.ai_all_response[n][o][i].loading=!1;let e=a.JsonParse(l);if(null!==e){let t=a.notUndefined(e,"choices.0.delta")??a.notUndefined(e,"choices.0"),s=a.notUndefined(t,"content")??a.notUndefined(t,"message"),l=a.notUndefined(t,"role");l&&s&&t&&(this.ai_all_response[n][o][i].item=s,this.ai_all_response[n][o][i].role=l)}return await this.setDataStorage(o,n),await this.waiting(!1),this.ai_all_response[n][o][i].item}return await r.map((async e=>{s++;const t=e.indexOf("{"),l=e.lastIndexOf("}")+1,r=e.substring(t,l);let c=a.JsonParse(r);if(a.notUndefined(c,"error.message"))return this.ai_all_response[n][o][i].loading=!1,this.ai_all_response[n][o][i].item=a.notUndefined(c,"error.message"),this.ai_all_response[n][o][i].role="error",await this.setDataStorage(o,n),await this.waiting(!1),this.ai_all_response[n][o][i].item;let u=a.notUndefined(c,"choices.0.delta"),g=a.notUndefined(u,"content")??"",p=a.notUndefined(c,"choices.0.finish_reason")??null;return this.ai_all_response[n][o][i].item+=g.toString(),d.debugMode&&console.log(a.notUndefined(c,"finish_text")),a.notUndefined(c,"finish_text")?(this.ai_all_response[n][o][i].item=a.notUndefined(c,"finish_text"),this.ai_all_response[n][o][i].role="system",this.ai_all_response[n][o][i].loading=!1,await this.setDataStorage(o,n),await this.waiting(!1),this.ai_all_response[n][o][i].item):(p&&null!==p&&(this.ai_all_response[n][o][i].finish_reason=p),s%15==0?await this.setDataStorage(o,n):await this.setData(o,n),s++,g)})),this.ai_all_response[n][o][i].item},linkify(e){if(null==e)return"";var t=/(\b(https:\/\/|http:\/\/|ftp:\/\/|file:\/\/|www\.|en\.|m\.)[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;return"function"!=typeof(e=e.toString()).replace?e:e.replace(t,(function(e){return-1!=e.indexOf("<a ")?e:(-1===e.indexOf("//")&&(e="//"+e),'<a href="'+e+'" target="_blank">'+e.replace("","")+"</a>")}))},waiting:async(e=!0)=>(0==e?document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-hide"),e.classList.remove("ait-show")})):document.querySelectorAll('[id*="ait-stop-chat-"]').forEach((e=>{e.classList.add("ait-show"),e.classList.remove("ait-hide")})),await a.Browser().storage.local.set({ai_wait:e})),prefixify(e){if(null==e)return"";let t=this.prompt_prefix.toString();return"function"!=typeof(e=e.toString()).replace||Object.keys(H).forEach((a=>{let n=H[a];Object.keys(n).forEach((o=>{let i=n[o],s=new RegExp(`\n${t}${a}_${o}${t}\n`.toString(),"gi"),l=new RegExp(`\n${t}${a}_${o}${t}`.toString(),"gi"),r=new RegExp(`${t}${a}_${o}${t}\n`.toString(),"gi"),c=new RegExp(`${t}${a} ${o}${t}\n`.toString(),"gi"),u=new RegExp(`${t}${a}_${o}${t}`.toString(),"gi");e=e.replace(s,i).replace(l,i).replace(r,i).replace(c,i).replace(u,i)}))})),e}};typeof window<"u"&&typeof document<"u"&&(window.getCookie=e=>{var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));if(t)return t[2]},window.setCookie=(e,t,a,n=null)=>{var o="";if(a){var i=new Date;i.setTime(i.getTime()+24*a*60*60*1e3),o="; expires="+i.toUTCString()}null==n&&(n=window.location.host,window.location.host.split(".").length>2&&(n="."+(n=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"="+(t||"")+o+"; path=/; domain="+n},window.eraseCookie=(e,t=null)=>{null==t&&(t=window.location.host,window.location.host.split(".").length>2&&(t="."+(t=window.location.host.split(".")).slice(1).join("."))),document.cookie=e+"=null; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/; domain="+t});class ie{start_key=0;check_key_time=null;notify=Z.useToast({duration:5e3,position:"top"});resizeBorder=(e,t=320,a=null)=>{if(null==e)return;let n;e.classList,e.id;let o=document.createElement("div");o.classList.add("ai-el-resize"),e.append(o);const i=a=>{const o=n-a.x;n=a.x;let i=parseInt(getComputedStyle(e,"").width)+o;i>=t&&(e.style.width=`${i}px`)};return o.addEventListener("mousedown",(function(e){e.offsetX<t&&(n=e.x,document.addEventListener("mousemove",i,!1),a&&a(n))}),!1),document.addEventListener("mouseup",(function(e){document.removeEventListener("mousemove",i,!1)}),!1),n};fetchWithTimeout=(e,t={},a=6e4)=>{let n=null,o={...t};if(a>0){let e=new AbortController;n=setTimeout((()=>{e.abort(),clearTimeout(n)}),a),o.signal=e.signal}return fetch(e,o).then((function(e){return null!=n&&clearTimeout(n),e})).finally((()=>{null!=n&&clearTimeout(n)}))};NodeSearch=(e,t)=>[...e].filter((e=>-1!==e.outerHTML.indexOf(t)));setKey=(e=!0)=>1==this.start_key||Math.floor((Date.now()-this.check_key_time)/1e3)<=1&&null!=this.check_key_time?a.Browser().storage.local.get("hopekey"):(d.debugMode&&console.log(this.check_key_time,Math.floor((Date.now()-this.check_key_time)/1e3)<=1||null==this.check_key_time),this.check_key_time=Date.now(),a.Browser().storage.local.get("hopekey").then((e=>typeof e.hopekey<"u"?(U.hopekey=e.hopekey??null,null==U.hopekey||"false"==U.hopekey?(fetch(U.api_url+"auth/logout",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())),a.Browser().storage.local.remove(["hopekey","merchants","credits"]).then()):a.Browser().storage.local.get("merchants").then((e=>{typeof e.merchants<"u"&&(U.merchants=e.merchants)}))):(this.start_key=1,fetch(U.site_url+"/extensions/app/get_key",{method:"POST",headers:{"Content-Type":"application/json"}}).then((e=>e.text())).then((e=>{if(typeof(e=JSON.parse(e)).data<"u"&&typeof e.data.key<"u"){if(U.debugMode&&console.log({hopekey:e.data.key}),a.Browser().storage.local.set({hopekey:e.data.key}).then(),typeof e.data.licences<"u"&&typeof e.data.licences.markets<"u"){let t={merchants:e.data.licences.markets};a.Browser().storage.local.set(t).then(),U.merchants=t.merchants}if(typeof e.data.token_usage<"u"&&typeof e.data.token_usage<"u"){let t={credits:e.data.token_usage};a.Browser().storage.local.set(t).then()}a.Browser().storage.local.set({is_login:!0}).then(),U.hopekey=e.data.key,U.debugMode&&console.log(U.merchants,U.hopekey)}this.start_key=0,U.debugMode&&console.log(e)})).catch((e=>{this.start_key=0,d.debugMode&&console.log(e)}))))));storageLocalClearAll=(e=!1)=>{let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual"];return 1==e&&(t=null),chrome.storage.local.get(t).then((e=>(d.debugMode&&console.log(e),a.Browser().storage.local.remove(Object.keys(e)))))};sendMessageWindowListener=(e,t,n)=>a.sendMessageListener(e,{},t);sendMessageListener=async(e,t,n,o=!1)=>{let i=[],s=null;if(typeof e.data<"u"&&(i=e.data),s=a.messageExecute(null,e.fn,i,!1,this),s&&"function"==typeof s.then&&o){let e=await s;e&&(s=e)}return null==n?{received:!0,return_data:s}:a.messageSendResponse(s,i,t,n)};sendMessage=(e,t={},n=null,o="scripting",i="runtime",s=null)=>{let l=null!=d.runtime_id?chrome??this.Browser()??{}:this.Browser(),r={fn:e,data:{data:t,callback:n,type:o}},c=e=>({received:!0,return_data:e});if(null===d.runtime_id&&!a.notUndefined(l[i],"sendMessage"))return a.onMessageExecutePre(r,{},c);if(!(typeof l[i]>"u"||typeof l[i].sendMessage>"u"))try{return l[i].sendMessage(s??l.runtime.id??null,r,c)}catch(u){return d.debugMode&&console.log(u),a.onMessageExecutePre(r,{},c)}};onMessageListener=()=>a.notUndefined(a.Browser().runtime,"onMessage")?a.Browser().runtime.onMessage.addListener(((e,t,n)=>a.onMessageExecutePre(e,t,n))):new Promise((e=>e(!1)));onMessageExecutePre=(e,t,n)=>{let o=[],i=null;return a.notUndefined(e,"data")&&(o=e.data),i=a.messageExecute(null,a.notUndefined(e,"fn")??null,o),a.messageSendResponse(i,o,t,n)};messageExecute=(e,t,n,o=!1,i={})=>{let s=null,l=n;a.notUndefined(l,"data")&&(l=l.data);let r=[],c=["object","function"],u={};if(null!=self&&(u=self),null!=t&&"function"!=typeof t&&(r="string"==typeof t?t.split("."):t,null==e)){let e=[typeof i<"u"?i:null,typeof u<"u"?u:null,typeof this<"u"?this:null,typeof ServiceWorkerGlobalScope<"u"?ServiceWorkerGlobalScope:null,typeof a<"u"?a:null,a.notUndefined(this,"Browser")?this.Browser():null];if(typeof r.forEach<"u"&&r.forEach((t=>{if(null==s){if(-1!==c.indexOf(typeof t))s=this.messageExecute(null,t,l,o);else for(const n of e)if(null!=n&&a.notUndefined(n,t)&&-1!==c.indexOf(typeof n[t])){s=this.messageExecute(null,n[t],l,o);break}}else s=s[t]??null})),"function"!=typeof s)return s??null;t=s}if(null!=e){if("object"==typeof e[t]&&typeof e[t].then>"u"||!0===o)return e[t]}else if(!0===o)return t;if("object"==typeof t&&null!=t&&"function"==typeof t.then)return t();if(null==e&&"object"==typeof t)return t;try{return null==e&&"function"==typeof t?Array.isArray(l)?t(...l):t(l):null==e&&null!=t?t:"object"==typeof e&&"function"==typeof e[t]?Array.isArray(l)?e[t](...l):e[t](l):null==e?void 0:typeof e[t]<"u"&&typeof e[t].then>"u"&&"object"==typeof e?e:Array.isArray(l)?e[t](...l):e[t](l)}catch{return null==e&&"function"==typeof t?t():null==e&&null!=t?t:null==e?void 0:typeof e[t]<"u"&&"object"==typeof e&&"function"==typeof e[t]?e[t]():"object"==typeof e&&typeof e[t].then>"u"?e:e[t]()}};messageSendResponse=(e,t,n,o,i={})=>{let s=null,l=a.notUndefined(t,"type")??"scripting",r=a.notUndefined(t,"callback")??null;if(r){s=this.messageExecute(null,t.callback,e,!0,i);let a=s.name;t.callback=s,t.callback_name=a}if(null==e)return o({received:!0,return_data:e});if("object"==typeof e&&"function"==typeof e.then){let s;return o({received:!0,return_data:e.then((e=>{if(typeof e<"u"&&typeof e.text<"u"&&(e=e.text()),typeof e<"u"&&typeof e.json<"u"&&(e=e.json()),typeof t.callback<"u"&&t.callback){let o=this.messageExecute(null,t.callback,e,!0,i),s=o.name;if(t.callback=o,t.callback_name=s,"scripting"==l)if(null==n)o(e,t);else{let i={target:{tabId:n.tab.id},function:o,args:[e,t]};a.Browser().scripting.executeScript(i).then()}else{let o=a.notUndefined(n.tab,"id")??null;null!=o&&null==d.runtime_id?(r=this.messageExecute(null,r,{result:e,data:t},!0,i),r&&r(e,t)):a.sendMessage(r,{data:{result:e,data:t}},null,"tabs","tabs",o)}}return e}))})}if(typeof t.callback<"u"&&null!=t.callback&&null!=s&&"function"==typeof t.callback){let o=this.messageExecute(null,t.callback,e,!0,i),s=o.name;if(t.callback=o,t.callback_name=s,"scripting"==l)if(null==n)o(e,t);else{let i={target:{tabId:n.tab.id},function:o,args:[e,t]};a.Browser().scripting.executeScript(i).then()}else{let o=a.notUndefined(n.tab,"id")??null;null!=o&&null==d.runtime_id?(s=this.messageExecute(null,s,{result:e,data:t},!0,i),s&&s(e,t)):a.sendMessage(s,{data:{result:e,data:t}},null,"tabs","tabs",o)}}return o({received:!0,return_data:e})};customAddListener=(e,t=[],a=[])=>{t.forEach((t=>{e[t].addListener(((e,t,n)=>{let o=!1;typeof e.status<"u"&&(t=e,e=(n=e).id),typeof t<"u"?typeof t.status<"u"&&typeof n.url<"u"&&"complete"===t.status&&-1===n.url.indexOf("chrome://")&&(o=!0):(typeof e.name<"u"||typeof e.title<"u"||Object.keys(e).length>0)&&(o=!0),o&&(a.forEach((a=>{let o=!1;"function"==typeof a?a(e,t,n):(typeof window<"u"&&!1===o&&"function"==typeof window[a]&&"function"==typeof window[a].apply&&(window[a].apply(e,t,n),o=!0),typeof ServiceWorkerGlobalScope<"u"&&!1===o&&"function"==typeof ServiceWorkerGlobalScope[a]&&ServiceWorkerGlobalScope[a](e,t,n),typeof this<"u"&&!1===o&&"function"==typeof this[a]&&this[a].call(e,t,n))})),U.debugMode&&console.log(e,t,n,a))}))}))};apiCall=async(e,t={},n="GET",i=6e4)=>{null==t&&(t={}),d.debugMode&&console.log(e,t,"Call");let s={headers:{accept:"application/json",hopekey:o.Local.uuid_hopekey??null},method:n};null!=d.runtime_id&&"/extensions/app/get_key"==e&&null==s.headers.hopekey&&delete s.headers.hopekey,null==d.runtime_id&&typeof window<"u"&&"function"==typeof window.getCookie&&(s.headers.hopekey=window.getCookie("hopekey")??o.Local.uuid_hopekey??null,null==s.headers.hopekey&&delete s.headers.hopekey);let l=-1!==e.indexOf("://")?e:`${d.api_url}${e}`;if(typeof o.Local<"u"){let e=o.Local;typeof e.settings<"u"&&a.notUndefined(e.settings,"language")&&(t.lang=e.settings.language)}return null!=d.runtime_id?(t.v=a.Browser().runtime.getManifest().version??null,t.ri=a.Browser().runtime.getManifest().id??d.runtime_id):t.v=d.version??null,Object.keys(t).length>0&&(s.body=JSON.stringify(t)),await a.fetchWithTimeout(l,s,i).then((e=>{try{return e.json()}catch{return e.text()}})).then((a=>{a=this.ajaxResponse(this.ajaxResponseChipper(a),0,1),d.debugMode&&console.log(e,t,a);try{return a}catch{return a}})).catch((o=>{if(d.api_call_try<d.api_call_max_try&&-1===l.indexOf("languages/lang/sync"))return setTimeout((()=>(console.error("Try",d.api_call_try,l,t,n,i),d.api_call_try++,a.apiCall(e,t,n,i))),4e3);console.warn(o)}))};ajaxResponse=(e,t=0,n=1)=>{if(typeof e>"u")return!1;if(1==t)return;if(typeof e.debug_time<"u"&&2!=d.debugMode)if(1==d.debugMode)console.log(e.redirect_uri,e.debug_time);else{let t={[e.redirect_uri]:e.debug_time};d.debug_time=Object.assign(d.debug_time,t)}let i={};return typeof e.languages<"u"&&(i.languages=e.languages,typeof o.Local<"u"&&(o.Local.languages=e.languages),typeof e.expire<"u"&&a.Browser().storage.local.get("expires").then((t=>{i.expires=t.expires??{},"object"!=typeof i.expires&&(i.expires={}),i.expires.languages=e.expire,o.Local.expires=i.expires,a.Browser().storage.local.set({expires:i.expires}).then(d.debugMode?console.log:null)}))),typeof e.expire<"u"&&typeof e.expire.name<"u"&&typeof e.expire.time<"u"&&a.Browser().storage.local.get("expires").then((t=>{i.expires=t.expires??{},"object"!=typeof i.expires&&(i.expires={}),i.expires[e.expire.name]=e.expire.time,o.Local.expires=i.expires,a.Browser().storage.local.set(i).then(d.debugMode?console.log:null)})),typeof e.language_variables<"u"&&typeof e.language_variables.variables<"u"&&(i.language_variables=e.language_variables.variables,typeof o.Local<"u"&&(o.Local.language_variables=e.language_variables.variables)),"object"==typeof i&&Object.keys(i).length>0&&(d.debugMode&&console.log(i,e,"STORAGE_SET"),a.Browser().storage.local.set(i).then(d.debugMode?console.log:null)),typeof e.notifications<"u"&&typeof document<"u"&&e.notifications&&Object.keys(e.notifications).forEach((t=>{t=e.notifications[t],typeof this.notify[t.type]<"u"&&this.notify[t.type](t.message)})),typeof e.data<"u"&&1==n?e.data:e};firstUpperCase=e=>`${e.substring(0,1).toUpperCase()}${e.substring(1)}`;ucFirstUpperCase=(e,t)=>{let a=e.split(t);return a.forEach(((e,t)=>{a[t]=`${e.substring(0,1).toUpperCase()}${e.substring(1)}`})),a.join(t)};JsonParse=e=>{let t=e;if(typeof e<"u"||null!=e)try{"string"==typeof e&&(t=JSON.parse(e)),"object"==typeof t&&Object.keys(t).length>0&&Object.keys(t).forEach((e=>{("object"==typeof t[e]||"string"==typeof t[e]&&(-1!==t[e].indexOf("{")&&-1!==t[e].indexOf("}")||-1!==t[e].indexOf("[")&&-1!==t[e].indexOf("]")))&&(t[e]=this.JsonParse(t[e]))}))}catch{}return t};settingsBuild=async(e=!1)=>new Promise((async(t,n)=>await a.Browser().storage.local.get(["settings","domain","languages"]).then((async n=>{if(typeof n.domain>"u"&&null!=n.domain&&a.domainByUrls(n.domain),n.settings){let e=!1;null!==n.settings.language&&(a.notUndefined(n.settings,"language_detail.lang_code")!==n.settings.language&&(e=!0),e&&null!==n.settings.language&&(w.language_detail=n.settings.language_detail=a.notUndefined(n.languages,`${n.settings.language}`),w.language_name=n.settings.language_name=a.notUndefined(n.languages,`${n.settings.language}.title`)))}return typeof n.settings>"u"?await a.Browser().storage.local.set({settings:w}).then((async()=>(await a.getLanguages(!0,w.language).then(),a.getActiveHistories(),await a.getModelSettings(),a.removeLoading(),t(w)))):(Object.keys(w).forEach((e=>{if(typeof w[e]<"u"){let t=w[e];n.settings&&typeof n.settings[e]>"u"&&(n.settings[e]=t)}})),n.settings&&a.Browser().storage.local.set({settings:n.settings}).then((async()=>{1==e&&(await a.getLanguages(!1,n.settings.language).then(),await a.getModelSettings(),await a.uuid(1==e?1:0))})),a.removeLoading(),t(n))}))));uuid=async(e=0)=>(a.removeFirstLoading(),new Promise((async(t,n)=>await a.Browser().storage.local.get().then((async i=>{o.Local=i,typeof i.developer<"u"&&null!=i.developer&&(a.notUndefined(i.developer,"beta_api")&&(d.api_url=`https://beta_api.${d.domain}`),a.notUndefined(i.developer,"debug_log")&&(d.debugMode=1)),a.Browser().storage.sync&&a.Browser().storage.sync.get().then((async e=>{o.Sync=e})),a.notUndefined(i,"settings")||(i.settings=w),null==i.settings&&(i.settings=w,i.settings.language=w.language,a.Browser().storage.local.set({settings:i.settings}).then()),d.debugMode&&console.log(w,365),null==typeof i.settings&&(i.settings=w),d.debugMode&&console.log(i.settings,367),typeof i.settings<"u"&&null!=i.settings&&typeof i.settings.ai_mode>"u"&&(i.settings=w);let s={ai_mode:i.settings.ai_mode,lang:i.settings.language,model:i.settings.ai_model,settings:i.settings};if(e||null==d.runtime_id&&typeof window<"u"&&(i.uuid_hopekey!=(window.getCookie("hopekey")??"nullS")||window.getCookie("aitopia_check_login"))&&(window.eraseCookie("aitopia_check_login"),e=1),e||!(typeof i.credit_usage<"u")||null==(i.uuid_hopekey??null))return"api"==s.ai_mode&&(s.ai_key=i.settings.ai_key),a.notUndefined(s.settings,"language_detail.variables")&&(delete s.settings.language_detail.variables,a.Browser().storage.local.set({settings:s.settings}).then()),await this.apiCall("/extensions/app/get_key",s,"POST").then((e=>{if(e){if(typeof e.key<"u"){o.Local.uuid_hopekey=e.key;let t={licences:null==e?void 0:e.licences,credit_usage:e.credit_usage,credit_detail:e.credit_detail,credit_detail_visual:e.credit_detail_visual,ai_models:e.models,image_editing:e.image_editing,google_auth_uri:e.google_auth_uri??null,user:null,email:null,uuid_hopekey:e.key,uuid_search:e.search_key,plan:e.plan.toCapitalizeCase()};a.notUndefined(e,"domain")&&(t.domain=e.domain,a.domainByUrls(e.domain)),typeof e.show_review<"u"&&(t.show_review=e.show_review),o.Local.settings&&"free"==e.plan&&typeof o.Local.settings.web_access<"u"&&(o.Local.settings.web_access=!1,t.settings=o.Local.settings),typeof e.user<"u"&&(t.user=e.user,typeof e.user.email<"u"&&(t.email=e.user.email)),typeof e.expire<"u"&&(a.notUndefined(o.Local,"expires")||(o.Local.expires={}),o.Local.expires.credits=e.expire,t.expires=o.Local.expires,d.debugMode&&console.log(o.Local.expires),d.debugMode&&console.log(t)),typeof window<"u"&&null!=t.uuid_hopekey&&d.domain_allows.forEach((e=>{window.setCookie("hopekey",t.uuid_hopekey,360,"."+e),window.eraseCookie("aitopia_check_login","."+e)})),a.Browser().storage.local.set(t).then((()=>a.removeLoading())),o.Local=Object.assign(o.Local,t)}return t(e)}})).catch((e=>(console.log(e),n())));a.removeLoading()})))));pricingDetail=()=>a.Browser().storage.local.get().then((e=>{if(o.Local=e,typeof e.packages<"u"&&(null==e.packages||""==e.packages)&&delete e.packages,typeof e.packages>"u")return this.apiCall("/extensions/app/get_pricing",null,"POST").then((e=>{if(e&&typeof e.packages<"u"){let t={packages:e.packages,faq:e.faq};o.Local=Object.assign(o.Local,t),typeof o.Local.expires>"u"&&(o.Local.expires={}),o.Local.expires.packages=e.expire,a.Browser().storage.local.set(t).then()}}))}));ajaxResponseChipper=e=>{if("string"!=typeof e)return e;try{return JSON.parse(T.AES.decrypt(e,"",{format:this.CryptoJSAesJson}).toString(T.enc.Utf8))}catch(t){throw console.log(t),"error"}};CryptoJSAesJson={stringify:function(e){var t={ct:e.ciphertext.toString(T.enc.Base64)};return e.iv&&(t.iv=e.iv.toString()),e.salt&&(t.s=e.salt.toString()),e.key&&(t.k=e.key.toString()),JSON.stringify(t)},parse:function(e){try{let n=T;var t=JSON.parse(e),a=n.lib.CipherParams.create({ciphertext:n.enc.Base64.parse(t.ct)});return t.iv&&(a.iv=n.enc.Hex.parse(t.iv)),t.s&&(a.salt=n.enc.Hex.parse(t.s)),t.s&&(a.key=n.enc.Hex.parse(t.k)),a}catch(n){throw console.log(n),"error"}}};_i;AesEnCrypt(e,t=null){let a=T;var n;return this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100}),a.AES.encrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString()}AesDeCrypt(e,t=null){let a=T;var n;return null==this._i&&(this._i=a.PBKDF2(this.MD5(t??d.hello_world_test),this.SHA1(t??d.hello_world_test),{keySize:8,iterations:100})),a.AES.decrypt(e,this._i,{iv:this._i,padding:a.pad.Pkcs7,mode:a.mode.CBC,hasher:a.algo.SHA256}).toString(a.enc.Utf8)}copyClipboard=e=>{let t=document.querySelector("#ait_clipboard");t.value=e,t.focus(),t.select(),document.execCommand("copy",!1,e),t.value="",this.notify&&this.notify.success(this.__("Copied."))};openPage=e=>{if(null==d.runtime_id)return void(0===e.url.indexOf(`.${d.main_dir}`)||0===e.url.indexOf(`${d.main_dir}`)?window.location=e.url.replace(`.${d.main_dir}`,"").replace(`${d.main_dir}`,"").replace(".html",""):window.location=e.url);let t=!1;a.Browser().tabs.query({}).then((n=>{n.forEach((n=>{if(typeof e.url<"u"&&n.id>0){e.url=e.url.replace("./","/");let o=e.url.split("?")[0];if((-1!==e.url.indexOf(d.extension_dir)||"/src/"==e.url.substring(0,5))&&-1!==n.url.indexOf(d.extension_dir))return a.Browser().tabs.update(n.id,{active:!0,url:e.url}).then(),void(t=!0);if(n.url==o||-1!==n.url.indexOf(o)||-1!==o.indexOf(n.url))return n.url==e.url?(chrome.tabs.reload(n.id).then(),a.Browser().tabs.update(n.id,{active:!0}).then()):(chrome.tabs.reload(n.id).then(),a.Browser().tabs.update(n.id,{active:!0,url:e.url}).then()),void(t=!0)}})),0==t&&a.Browser().tabs.create({url:e.url}).then()}))};messageCallback(e,t){e(t)}notUndefinedBuilder=(e,t)=>!1!==t.indexOf(".")?(t.split(".").forEach((t=>{t=t.replace("###","."),typeof e<"u"&&e&&(e=typeof e[t]<"u"?e[t]:null)})),e):!!(typeof e<"u"&&e&&typeof e[t]<"u")&&e[t];notUndefined=(e,t)=>{if(null==t)return!1;if("string"==typeof t)return this.notUndefinedBuilder(e,t);if("object"==typeof t){let a=!0;return null!=t?t.forEach((t=>{this.notUndefinedBuilder(e,t)||(a=!1)})):a=!1,a}return null};SHA1=e=>(e+="_crypt",T.SHA1(e).toString());MD5=e=>(e+="_md5",T.MD5(e).toString());isPinned=e=>{if(null!=e&&document.querySelector(".setup_page #check_toolbar")){let a=document.querySelector(".setup_page #check_toolbar");if(1==e.isOnToolbar){a.value=e.isOnToolbar;var t=new Event("change");a.dispatchEvent(t)}}};minifierExpand=(e,t)=>{let a={};return e&&t?(Object.keys(e).forEach((n=>{let o=e[n];o&&Object.keys(o).forEach((e=>{let i=o[e];typeof a[n]>"u"&&(a[n]={}),a[n][t[e]]=this.JsonParse(i)}))})),a):e};filenameByFaIcon(e,t=null){let a=null;const n={excel:["xlsx","xls"],word:["doc","docx"],powerpoint:["pptx","ppt"],pdf:["pdf"],image:["jpg","jpeg","webp","png","tiff","svg","gif","avif","apng"],video:["webm","mkv","flv","flv","vob","ogv","ogg","drc","gif","gifv","mng","avi","MTS","M2TS","TS","mov","qt","wmv","yuv","rm","rmvb","viv","asf","amv","mp4","m4p","m4v","mpg","mp2","mpeg","mpe","mpv","mpg","mpeg","m2v","m4v","svi","3gp","3g2","mxf","roq","nsv","flv","f4v","f4p","f4a","f4b"],zipper:["zip","rar","7z"],audio:["mp3","wav","ogg","flac","aac","wma","m4a","ape","alac","aiff","mid","amr","pcm","au","ra","aac","ac3","dts","mka","opus","midi","3ga","webm","caf","m4r","tta","wv"],code:["php","html","css","js","py","java","c","cpp","h","hpp","xml","json","sql","rb","swift","kt","pl","go","ts","dart","sh","bat","ps1"]},o={excel:"#1d6f42",word:"#41A5EE",powerpoint:"#D04423",pdf:"#f40f02"};return Object.keys(n).forEach((i=>{n[i].forEach((n=>{if(-1!==e.indexOf(`.${n}`))return a=i,null==t&&(t=o[i]??t),{name:a,color:t}}))})),null==a&&(a="lines"),""==t&&(t=null),{name:a,color:t}}async getModelSettings(){return await new Promise((async(e,t)=>await a.Browser().storage.local.get("model_settings").then((async t=>{if(typeof t.model_settings<"u"&&null!=t.model_settings&&Object.keys(t.model_settings).length>0)return await e(t.model_settings);await a.apiCall("/ai/model_settings",{},"POST").then((async e=>e?(await a.Browser().storage.local.set({model_settings:e}),e):setTimeout(a.getModelSettings,1e3))),e(t)}))))}slugify=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");vueDefaultChecker(e,t,n,i,s=null,l=!0){if(n=a.notUndefined(n,a.notUndefined(i,"model_prefix")),0!=l)return n===s;if(null!=s&&null!=n)return n!=s?null:s;let r=a.notUndefined(e,t);if(null!=r)return r;let c=r??a.notUndefined(e,a.notUndefined(i,"model_default"))??s??a.notUndefined(i,"default"),u=!0;return typeof n<"u"&&(u=n==c),0==l?typeof c>"u"?null:c:(1==u&&null!=c&&a.notUndefined(o.Local,t),u)}autoHeightTextArea(e,t=null){e.style.height="unset",null==t&&(t=e.style.maxHeight.match(/[-+]?([0-9]*\.[0-9]+|[0-9]+)/)[0]??200),t<=e.scrollHeight&&(e.style.height=e.scrollHeight+"px")}getReadableFileSizeString(e){var t=-1,a=[" kB"," MB"," GB"," TB","PB","EB","ZB","YB"];do{e/=1024,t++}while(e>1024);return Math.max(e,.1).toFixed(2)+a[t]}__(e,t="tr"){if(null==e)return e;let n=T.SHA1(e).toString(),i=d.lang_cache_type;return null!=w&&"object"==typeof o.Local.languages&&typeof w.language<"u"&&null!==o.Local.languages&&null!==w.language&&typeof o.Local.languages[w.language]<"u"&&(null==w.language_name||""==w.language_name)&&typeof o.Local.languages[w.language].name<"u"&&typeof o.Local.settings<"u"&&(a.notUndefined(o.Local,"settings.language")&&(w.language=a.notUndefined(o.Local,"settings.language")),o.Local.settings.language_name=w.language_name=o.Local.languages[w.language].name,o.Local.settings.language_detail=w.language_detail=o.Local.languages[w.language],a.Browser().storage.local.set({settings:o.Local.settings}).then()),typeof o<"u"&&null!==w.language_name&&typeof o[i]<"u"&&a.notUndefined(o[i],"language_variables")&&typeof o[i].language_variables[n]<"u"?o[i].language_variables[n]:e=this.setLangVar(n,e)}async getLanguages(e=!1,t=null,n=null){let i=d.lang_cache_type;t=t??o[i].settings.language??w.language;let s=!1;if(typeof o[i].languages<"u"&&(0==Object.keys(o[i].languages??{}).length||null==o[i].languages||"{}"==o[i].languages)&&(delete o[i].languages,delete o[i].language_variables,delete o[i].language_var_sync),typeof o[i].languages>"u"||e)return null!=n&&(o[i].settings.language=n.settings.language=t),typeof o[i].languages>"u"&&(o[i].languages={},s=!0),await a.apiCall("/languages/lang/get/lang/"+t,{language:t},"POST").then((e=>{try{return typeof e>"u"||typeof e.languages>"u"?void 0:(e=a.JsonParse(e),s&&a.Browser().storage[i.toLowerCase()].set({languages:JSON.stringify(e.languages)}).then(),typeof e.expire<"u"&&(a.notUndefined(o.Local,"expires")||(o.Local.expires={}),o.Local.expires.languages=a.JsonParse(e.expire),a.Browser().storage[i.toLowerCase()].set({expires:o.Local.expires}).then()),o[i].language_variables=a.JsonParse(e.language_variables.variables),o[i].languages=a.JsonParse(e.languages),a.Browser().storage[i.toLowerCase()].set({language_variables:JSON.stringify(e.language_variables.variables),languages:o[i].languages}).then((e=>a.Browser().storage[i.toLowerCase()].get("settings").then((e=>(o[i].settings=e.settings??w,o[i].settings.language_name=w.language_name=o[i].languages[t].name,o[i].settings.language_detail=w.language_detail=o[i].languages[t],o[i].settings.language=w.language=t,a.Browser().storage.local.set({settings:o[i].settings}).catch((e=>console.log(e))).finally((()=>{typeof n<"u"&&null!=n&&"function"==typeof n.changeSettings&&(n.changeSettings(),1==Object.keys(n.ai_chat).length&&"function"==typeof n.newChat&&n.newChat()),a.Browser().tabs&&a.Browser().tabs.query({url:d.site+"/*"}).then((e=>{e.forEach((e=>{null!=t&&null!=a.Browser().scripting&&"complete"==e.status&&a.Browser().scripting.executeScript({target:{tabId:e.id},func:this.changeSiteLanguage,args:[t]}).catch((t=>{console.warn(t,e)})).then()}))}))}))))))))}catch(l){console.log(l)}}))}changeSiteLanguage=(e=null)=>{if(null==e){let t=o.Local;typeof t.settings<"u"&&typeof t.settings.language<"u"&&null!=t.settings.language&&(e=t.settings.language)}null!=e&&(window.lang=e,localStorage.getItem("lang")!=window.lang&&(localStorage.setItem("lang",e),localStorage.removeItem("languages"),localStorage.removeItem("language_variables")))};setLangVar(e,t){let n=d.lang_cache_type,i=!1;if(!(null==t||typeof o>"u"||typeof o[n]>"u"))return typeof o[n].language_variables>"u"&&(o[n].language_variables={}),a.notUndefined(o[n],"language_variables")||(o[n].language_variables={}),a.notUndefined(o[n].language_variables,e)||(i=!0),"string"==typeof o[n].language_variables&&null!=o[n].language_variables&&(o[n].language_variables=JSON.parse(o[n].language_variables)),o[n].language_variables[e]=t,"development"!=d.mode||t&&0==i||(typeof o[n].language_var_sync>"u"&&(o[n].language_var_sync={}),("object"!=typeof o[n].language_var_sync||null==o[n].language_var_sync)&&(o[n].language_var_sync={}),o[n].language_var_sync[e]=t,a.Browser().storage[n.toLowerCase()].set({language_var_sync:JSON.stringify(o[n].language_var_sync)}).then()),t}async captureCurrentViewport(){return new Promise(((e,t)=>{console.log(a.Browser().tabs,a.Browser().tabs.captureVisibleTab),a.Browser().tabs.captureVisibleTab(void 0,{format:"jpeg",quality:80}).then((a=>a?e(a):t(null)))}))}setAIImageURL(e){let t=d.lang_cache_type;typeof o[t]>"u"||(a.Browser().storage[t.toLowerCase()].set({ai_image_url:e}).then(),typeof o[t].ai_image_url>"u"&&(o[t].ai_image_url={}),o[t].ai_image_url=e)}syncLangVar(){setTimeout((()=>{if("development"!=d.mode)return;let e=d.lang_cache_type;if(a.Browser().storage[e.toLowerCase()].set({language_var_sync:JSON.stringify(o[e].language_var_sync)}).then(),a.Browser().storage[e.toLowerCase()].set({language_variables:JSON.stringify(o[e].language_variables)}).then(),typeof o[e].language_var_sync<"u"){if(!a.notUndefined(o[e],"language_var_sync"))return;let t=o[e].language_var_sync;if(Object.keys(t).length>0){let n={data:t,language:"en"};a.apiCall("/languages/lang/sync",n,"POST",-1).then((t=>{a.Browser().storage[e.toLowerCase()].remove(["language_var_sync"]).then()}))}}}),2e3)}auth(e,t,a="register",n){let o=n.target,i=!1;o.setAttribute("disabled","disabled");let s=o.closest(`#${a}`);document.querySelectorAll(".input-error").forEach((e=>{e.classList.remove("input-error")}));let l=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return null==t.email&&(t.email=""),(t.email.length<3||!t.email.match(l))&&(null!=s&&s.querySelector('[name="email"]').classList.add("input-error"),this.notify.error(this.__("Please check your e-mail address.")),i=!0,o.removeAttribute("disabled")),"register"==a?(null==t.password&&(t.password=""),null==t.password1&&(t.password1=""),null==t.agree&&(t.agree=!1),t.password.length<3&&(null!=s&&s.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),o.removeAttribute("disabled"),i=!0),t.password1.length<3&&(null!=s&&s.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Please check your confirm password.")),o.removeAttribute("disabled"),i=!0),t.password1!=t.password&&(e.forms.password1=null,null!=s&&s.querySelector('[name="password1"]').classList.add("input-error"),this.notify.error(this.__("Your passwords do not match. Please check and try again.")),o.removeAttribute("disabled"),i=!0),0==t.agree&&(null!=s&&s.querySelector('[name="agree"]').classList.add("input-error"),this.notify.error(this.__("I have read and agree to terms.")),o.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/register",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return this.uuid(1).then((()=>{e.login=!0,o.removeAttribute("disabled")}));o.removeAttribute("disabled")}))):"login"==a?(null==t.password&&(t.password=""),t.password.length<3&&(null!=s&&s.querySelector('[name="password"]').classList.add("input-error"),this.notify.error(this.__("Please check your password.")),o.removeAttribute("disabled"),i=!0),1==i?void 0:this.apiCall("/auth/login",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?this.uuid(1).then((()=>{e.login=!0,o.removeAttribute("disabled")})):t;o.removeAttribute("disabled")}))):"recover"==a?1==i?void 0:this.apiCall("/auth/reset_password",t,"POST").then((t=>{if(!(typeof t.status<"u"&&"error"==t.status))return"success"==t.status?(e.login_type="login",o.removeAttribute("disabled"),!0):t;o.removeAttribute("disabled")})):void 0}scrollToBottom(e="#ai-message-container,#ait-prompt-container"){document&&document.querySelectorAll(e).forEach((e=>{let t=e;setTimeout((()=>{typeof t.scrollTop<"u"&&(t.scrollTop=t.scrollHeight+1e3)}),100)}))}newChatId(){return Date.now()}ChatId(e,t,n=0){let i=null,s=o.Local.ai_chat_ids??{};return typeof s<"u"&&0==n&&typeof s[e]<"u"&&(null!=t&&"__all"!=t?(s[e][t]||"number"==typeof s[e])&&(i=s[e][t]):i=s[e]),null==i&&(n=1),e&&1==n&&(t?((typeof s[e]>"u"||"object"!=typeof s[e])&&(s[e]={}),i=s[e][t]=this.newChatId()):i=s[e]=this.newChatId()),a.Browser().storage.local.set({ai_chat_ids:s}).then(),i}GoogleSearchCall=async e=>{if(null==d.runtime_id)return!1;let t=a.notUndefined(o.Local,"settings.language")??null;if(null==t)try{return fetch("https://www.google.com/search?q="+e+"&sourceid=chrome&ie=UTF-8").then((e=>e.text())).catch(console.log)}catch{return!1}try{return fetch(`https://www.google.com/search?hl=${t}&lr=lang_${t}&as_q=${e.replace(/ /gi,"+")}&sourceid=chrome&ie=UTF-8`).then((e=>e.text())).catch(console.log)}catch{return!1}};GoogleSearchCallback=async(e,t={},n=!0)=>{let i=null;"object"==typeof e&&typeof e.result<"u"&&(t=e.data??{},e=e.result??{},i=a.notUndefined(t,"data"));let s=(new DOMParser).parseFromString(e,"text/html"),l="",r={},c=0,u="",g="",p={},_=s.querySelector("#search block-component table");null!=_&&(_=_.outerHTML);let h="";if(null!=_){let e=s.querySelectorAll("#search block-component table");null!=s.querySelector("#search block-component table table")&&(e=s.querySelectorAll("#search block-component table table")),e.forEach((e=>{e.querySelectorAll("tr").forEach(((e,t)=>{let a=e;null!=a.querySelector("th")?(a.querySelectorAll("th").forEach((e=>{let t=e;null!=t.querySelector('span[aria-hidden],[class*="hide"]')?null!=t.querySelector("* span:last-child")&&(h+="  "+t.querySelector("* span:last-child").innerText.trim()):h+="  "+t.innerText.trim()})),h=h.trim()+"\n"):(a.querySelectorAll("td").forEach((e=>{let t=e;null!=t.querySelector("span[aria-hidden]")?null!=t.querySelector("* span:last-child")&&(h+="  "+t.querySelector("* span:last-child").innerText.trim()):h+="  "+t.innerText.trim()})),h=h.trim()+"\n")}))}))}null!=s.querySelectorAll("#search [data-snc]")&&s.querySelectorAll("#search [data-snc]").forEach(((e,t)=>{Object.keys(r).length<=(d.web_access_search_limit??5)&&(e.querySelectorAll("[data-sncf],[data-snhf]").forEach(((e,t)=>{let a=!1,n=e,o=n.querySelector("a h3"),i=null;if(null!=o&&(a=!0,u=o.closest("a").getAttribute("href"),g=o.innerText),a||(i=n.querySelectorAll("a"),null!=i&&i.forEach((e=>{p[e.innerText]=e.getAttribute("href")}))),-1===n.innerHTML.indexOf('role="img"')&&!a){let e=n.innerText.split(" — ");l+=e[1]??e[0]}n.getAttribute("data-sncf")})),r[c]={text:l,url:u,title:g,sub_links:p},g=u=l="",p={},c++)}));let m=null;null!=s.querySelector("#search [data-entityname] [data-domdiff]")&&(m=s.querySelector("#search [data-entityname] [data-domdiff]").innerText.replace(/\n/gi," ")??null);let y=[];null!=s.querySelector("#search [data-q]")&&s.querySelectorAll("#search [data-q]").forEach((e=>{y.push(e.innerText)}));let f="";null!=s.getElementById("rhs")&&(null!=s.querySelector("g-card-section")&&s.querySelectorAll("g-card-section").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(f+="\n"+t)}})),null!=s.querySelector("#rhs g-link")&&s.querySelectorAll("#rhs g-link").forEach((e=>{if(null==e.closest('[role="button"]')){let t=e.innerText;t.length>0&&(f+="\n"+t)}})),s.querySelectorAll("#rhs [data-maindata]+div span,#rhs [data-maindata]+div .title").forEach((e=>{let t=e;null==t.closest('[role="button"]')&&t.innerText&&(f+="\n"+t.innerText)})),""==f&&(f=f.trim()));let b={};try{b={original_ask:i,data:r,extra:m,questions:y,detail:f,table:h}}catch{}let x=!1;if(Object.keys(a.notUndefined(b,"data")).length>0&&(x=!0),!x&&(a.notUndefined(e,"data.data")||a.notUndefined(t,"data"))){let n=await this.apiCall("/ai/search",{q:a.notUndefined(e,"data.data")||a.notUndefined(t,"data"),lang_code:a.notUndefined(o.Local,"settings.language")??null,model:w.ai_model},"POST");a.notUndefined(n,"data")&&(b={original_ask:a.notUndefined(n,"original_ask"),data:a.notUndefined(n,"data"),extra:null,questions:a.notUndefined(n,"questions"),detail:null,table:null})}if(n){let e=typeof a.Browser().web_access_mode<"u"?a.Browser().web_access_mode:"ai_chat",t=typeof a.Browser().web_access_extra_key<"u"?a.Browser().web_access_extra_key:"__all";te.chat(i,w.ai_model,e,t,!0,!1,null,!0,{search:b,web_access:!0})}return new Promise(((e,t)=>e(b)))};cleanTextEmpty(e){return e&&e.replace(/[\r\n]+/gm," ").replace(/[\t]+/gm," ").replace(/[\s]+/gm," ").trim()}setSidebar(){if(!document)return;let e=document.createElement("div");e.id="aitopia-container";let t=document.createElement("div");t.id="aitopia",null!=document.querySelector("#aitopia-full-screen")?(t.id="aitopia-full",document.querySelector("#aitopia-full-screen").classList.add("aitopia")):t.classList.add("aitopia"),t.append(e);let a=document.querySelector("body");if(-1==(a.getAttribute("id")??"").indexOf("aitopia")){let e="html";a=document.querySelector(e)}null==a||a.append(t)}tabExtensionPage=(e=null)=>{if(a.notUndefined(e,"filters")){let t=!0;return a.Browser().tabs.query(a.notUndefined(e,"filters")).then((n=>{n.forEach((n=>{if(t=!1,a.notUndefined(e,"filter_url")?-1!==n.url.indexOf(a.notUndefined(e,"filter_url"))&&(t=!0):t=!0,console.log(t,a.notUndefined(e,"filter_url")),a.notUndefined(e,"url")&&t&&(e.active=!0,a.Browser().tabs.update(n.id,{url:e.url}).then()),t)return n}))}))}};removeEmptyLines(e){return e&&e.replace(/^\s*[\r\n]/gm,"").trim()}treeKeybyValueBuild(e,t,a,n=".",o=0,i={}){return"object"!=typeof e&&(e=e.split(n)),typeof e[o]>"u"?t:(typeof a[e[o]]<"u"&&(i[e[o]]=a[e[o]]),i[e[o]]=this.treeKeybyValueBuild(e,t,a,n,o+1,i[e[o]]??{}),i)}Browser(){return d.Browser}addLoading(){if(null==d.runtime_id&&typeof document<"u"){let e="body > .aitopia";return null==d.runtime_id&&(e="body.aitopia"),void(null!=document.querySelector(e)&&null==document.querySelector(e+".ait-page-loading")&&document.querySelector(e).classList.add("ait-page-loading"))}}removeLoading(){let e=".ait-page-loading-container";if(null!=d.runtime_id&&(e="#aitopia-full-screen .ait-page-loading-container"),typeof document<"u"&&null!=document.querySelector(e)&&(document.querySelectorAll(e).forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(e).forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(e).forEach((e=>e.remove())),a.scrollToBottom()}),5)),typeof document<"u"){let e="body > .aitopia";null==d.runtime_id&&(e="body.aitopia"),setTimeout((()=>{null!=document.querySelector(e+".ait-page-loading")&&document.querySelector(e+".ait-page-loading").classList.remove("ait-page-loading"),a.scrollToBottom()}),1)}}removeFirstLoading(){null==d.runtime_id&&typeof document<"u"&&null!=document.querySelector(".ait-page-loading-container")&&(document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.classList.add("ait-loading-calm"))),document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove())),setTimeout((()=>{document.querySelectorAll(".ait-page-loading-container").forEach((e=>e.remove()))}),5))}async getIpDetail(){return{}}SyncAppAndExtensionOrTabs=async(e=null)=>{"object"==typeof e&&null!=e&&0==Object.keys(e).length&&(e=null);let t=null;null==d.runtime_id&&(t=d.domain);let n=!0,o=!1;null!=e&&(typeof e.back<"u"&&(n=!1),typeof e.type<"u"&&(o=e.type),typeof e.setter_domain<"u"&&(t=e.setter_domain),typeof e.storage<"u"&&(e=e.storage));let i={storage:e,type:o,setter_domain:t};if(null!=d.runtime_id)return null!=e&&await a.GetSetSyncData(i),await a.TabMessageSync({target:null,function:async e=>(e.back=!1,await window.postMessage({fn:"SyncAppAndExtensionOrTabs",data:e})),args:[i]},t);if(null==e){if(!a.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;i.storage=await a.GetSetSyncData();let e=await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"GetSetSyncData",data:i});if(i.storage=a.notUndefined(e,"return_data"),i.type=!0,"object"==typeof i.storage&&null!=i.storage&&0==Object.keys(i.storage).length&&(i.storage=null),null==i.storage)return{}}else if(i.type=!1,n){if(!a.notUndefined(d.ExtensionBrowser,"runtime.sendMessage"))return!1;await d.ExtensionBrowser.runtime.sendMessage(d.manuel_extension_id,{fn:"SyncAppAndExtensionOrTabs",data:i})}return await a.GetSetSyncData(i)};GetSetSyncData=async(e=null)=>{if(null!=e){let t=!1;a.notUndefined(e,"setter_domain")&&a.notUndefined(e,"setter_domain"),typeof e.type<"u"&&(t=e.type);let n=a.notUndefined(o.Local,"migration"),i=a.notUndefined(e,"storage.local.migration");return null==i&&(i=a.notUndefined(e,"storage.local.ai_chat_ids.ai_chat")),0==t&&(t=n<i||null==n),1==t&&a.notUndefined(e,"storage")?(Object.keys(e.storage).forEach((t=>{if(a.notUndefined(a.Browser().storage,t)){let s=t.toCapitalizeCase();null==n&&(e.storage.local.migration=i??(new Date).getTime()),e.storage[t]&&(e.storage[t]=a.JsonParse(e.storage[t]),(typeof e.storage[t].settings>"u"||null!=a.notUndefined(e.storage[t],"settings"))&&(o.Local.migration_status=!0,e.storage[t].migration_status=!0,a.Browser().storage[t].set(e.storage[t]).then((()=>{o.Local.migration_status=!1,a.Browser().storage.local.set({migration_status:!1}),o[s]=Object.assign(o[s],e.storage[t])}))))}})),{}):{local:a.JsonParse(o.Local),sync:a.JsonParse(o.Sync),runtime_id:d.runtime_id}}return{local:a.JsonParse(o.Local),sync:a.JsonParse(o.Sync),runtime_id:d.runtime_id}};TabMessageSync=async(e,t=null)=>{if(a.notUndefined(a.Browser().tabs,"query")&&d.domain_allows&&e){let n=/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n\?\=]+)/im,i=Object.values(d.domain_allows);null!=t&&-1!==i.indexOf(t)&&i.splice(i.indexOf(t),1),i.forEach((t=>{a.Browser().tabs.query({status:"complete"}).then((i=>{i.forEach((async i=>{let s=i.url.match(n)[1]??null;null!=s&&-1!==s.indexOf(d.web_app_prefix+t)&&(-1!==i.url.indexOf("https://"+d.web_app_prefix+t+"/")||-1!==i.url.indexOf("https://beta_"+d.web_app_prefix+t+"/"))&&(o.Local.migration_status=!0,e.target={tabId:i.id},await a.Browser().scripting.executeScript(e),o.Local.migration_status=!1,await a.Browser().storage.local.set({migration_status:!1}))}))}))}))}};getHistories=(e=!1)=>new Promise((t=>a.Browser().storage.local.get("histories").then((n=>typeof n.histories<"u"&&0==e&&null!=n.histories&&Object.keys(n.histories).length>0?t(n.histories):a.apiCall("/extensions/app/get_history",null,"POST").then((async e=>{if(a.notUndefined(e,"all_histories")){let t=a.notUndefined(e,"all_histories");return t&&(t=a.getHistoryFixer(t)),a.Browser().storage.local.set({histories:t}),t}}))))));getActiveHistories=async(e={})=>{let t=await a.Browser().storage.local.get("ai_chat_ids")??{};return t.ai_chat_ids&&(t=t.ai_chat_ids),await a.apiCall("/extensions/app/get_active_history",{chat_ids:t},"POST").then((async e=>{if(a.notUndefined(e,"histories")){let n=a.notUndefined(e,"histories"),i=a.notUndefined(e,"history_ids");n&&(n=a.getHistoryFixer(n));let s=await a.Browser().storage.local.get("ai_single").ai_single??{};s=Object.assign(s,n.ai_single);let l={};return n.ai_chat&&Object.keys(n.ai_chat).length>0&&(l.ai_chat=n.ai_chat),s&&Object.keys(s).length>0&&(l.ai_single=s),i&&Object.keys(i).length>0&&(i=Object.assign(i,t),l.ai_chat_ids=i,o.Local.ai_chat_ids=i),Object.keys(l).length>0&&await a.Browser().storage.local.set(l),o.Local=Object.assign(o.Local,l),{histories:n,history_ids:i}}}))};getHistoryFixer=e=>{let t=this.__("Hello, how can I help you today?");return Object.keys(e).forEach((n=>{a.notUndefined(e,n)&&(a.notUndefined(e[n],"0.role")?"user"==a.notUndefined(e[n],"0.role")&&(e[n]=[{item:t,role:"assistant",model:a.notUndefined(e[n],"0.model"),loading:!1},...Object.values(e[n])]):Object.keys(e[n]).forEach((o=>{a.notUndefined(e[n],o)&&a.notUndefined(e[n][o],"items")&&"user"==a.notUndefined(e[n][o].items,"0.role")&&(e[n][o].items=[{item:t,role:"assistant",model:a.notUndefined(e[n][o].items,"0.model"),loading:!1},...Object.values(e[n][o].items)])})))})),e};getSearchFilter=(e,t=null,a=!1)=>t?Object.values(e).filter((e=>Object.values(e).some((e=>"object"==typeof e&&1==a?JSON.stringify(e).toString().toLowerCase().includes(t.toLowerCase()):e.toString().toLowerCase().includes(t.toLowerCase()))))):e;getKeySearch=(e,t=null,a=!1,n=!1)=>{if(!t)return e;let o=null;return o=1==a?{}:[],Object.keys(e).some((i=>{i.toString().toLowerCase().includes(t.toLowerCase())&&(1==a?n?o[i.replace(t,"")]=e[i]:o[i]=e[i]:o.push(i)),i.toString().toLowerCase().includes(t.toLowerCase())})),o};domainByUrls=e=>{a.Browser().storage.local.set({domain:e});let t=d.web_app_prefix+e,n={domain:e,site:`https://${t}`,site_buy_plan:`https://${t}/subscription`,site_payment:`https://${t}/payment`,site_pricing:`https://${t}/pricing`,login:`https://${t}/auth`,api_url:`https://extensions.${e}`,download_url:`https://download.${e}`,cdn_url:`https://cdn.${e}`};return d.domain_allows&&-1===d.domain_allows.indexOf(e)&&d.domain_allows.push(e),Object.keys(n).forEach((e=>{d[e]=n[e]})),n};ObjectSorting=(e,t=!0,a=null)=>Object.fromEntries(Object.entries(e).sort((([,e],[,n])=>(null!==a&&(typeof e[a]<"u"&&(Number.isNaN(parseFloat(e[a]))||(e=e[a])),typeof n[a]<"u"&&(Number.isNaN(parseFloat(n[a]))||(n=n[a]))),t?parseFloat(e)-parseFloat(n):parseFloat(n)-parseFloat(e)))));clearStorage=(e=!1)=>{1==e&&(a.Browser().storage.local&&a.Browser().storage.local.clear(),a.Browser().storage.sync&&a.Browser().storage.sync.clear());let t=["token_usage","credits","licences","uuid_hopekey","uuid_search","expires","credit_usage","credit_detail","credit_detail_visual","start_scrap","language_var_sync","language_variables","languages","ai_models","ai_prompts","selected_ask","selected_question","selected_write","prompt_settings","model_settings","files","faq","packages","developer","domain","draggable_modal_history","ai_chat_ids","ai_contextPrompts","delete_key","ai_single"];a.Browser().storage.local.get().then((e=>{a.Browser().storage.local.remove(a.getKeySearch(e,"ai_single_"))})),console.log(t);let n={ai_single:[a.SHA1("image")]};a.Browser().storage.local.get("delete_key").then((e=>{"object"==typeof e.delete_key&&Object.values(e.delete_key).forEach((e=>{n.ai_single.push(e)}))})),a.Browser().storage.local.get("ai_prompts").then((e=>{let t={};if(typeof e.ai_prompts<"u"){try{t=JSON.parse(e.ai_prompts)}catch{t=e.ai_prompts}let n=[];Object.values(t).forEach((e=>{let t=e.mode;"object"==typeof t&&(t=t.join(",")),-1==n.indexOf("selected_"+t)&&n.push("selected_"+t)})),a.Browser().storage.local.remove(n).then()}})),a.Browser().storage.local.remove(t).then(),Object.keys(n).forEach((e=>{a.Browser().storage.local.get(e).then((t=>{if(typeof t[e]<"u"){let o=!1,i=!1;try{t[e]=JSON.parse(t[e]),i=!0}catch{}let s=n[e];null!==t[e]&&("object"==typeof t[e]?Object.keys(t[e]).forEach((a=>{-1===s.indexOf(a)&&(o=!0,delete t[e][a])})):(o=!0,delete t[e])),i&&(t[e]=JSON.stringify(t[e])),o&&a.Browser().storage.local.set(t).then()}}))})),a.Browser().storage.local.remove(["ai_setup"]).then(),a.Browser().storage.local.set({show_sidebar:!1}).then(),console.log("clearStorage")};promptIdByGetValues=e=>{let t=o.Local.prompt_settings,n=o.Local.model_settings,i={};return t&&(Object.keys(t).forEach((o=>{if(-1!==o.indexOf(e)){let e=o.split("-_-"),s=e[0],l=t[o],r=a.notUndefined(n,`${s}`),c=a.notUndefined(r,`items.${l}`),u=a.notUndefined(c,"title");i[o]={name:r.title,id:e[0]??null,value:l,priority:e[1].split("_")[1]??0,title:u??s}}})),i=a.ObjectSorting(i,!0,"priority")),i};emptyResolve=()=>new Promise(((e,t)=>{}));onSettingTypeByValue(e,t){if(e&&typeof e.type<"u"){if(typeof e.mode<"u"&&"attribute"==e.mode)return t.getAttribute(e.type);if(typeof t[e.type]<"u")return t[e.type]}}emailSuggestion=async(e,t,n)=>{let o=this.MD5(e);return a.Browser().storage.local.get("email_suggestions").then((async i=>a.notUndefined(i,"email_suggestions."+o)?a.notUndefined(i,"email_suggestions."+o):await this.apiCall("/ai/email_suggestion",{text:e,history:t,extra_data:n},"POST").then((e=>(i[o]=e,e)))))}}Object.defineProperty(String.prototype,"toFirstUpperCase",{value:function(){return this?`${this.substring(0,1).toUpperCase()}${this.substring(1)}`:this}}),Object.defineProperty(String.prototype,"toCapitalizeCase",{value:function(){if(!this)return this;let e=this.split(" ");return e.forEach(((t,a)=>{e[a]=t.toFirstUpperCase()})),`${e.join(" ")}`}});const a=new ie;export{te as A,a as H,o as S,w as a,d as c};